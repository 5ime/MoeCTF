{include file="header" title="$title" /}
    <div class="i-card-main userhome">
        <div class="avatar">
            <img src="data:image/png;base64,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" alt="avatar"/>
        </div>
        <div class="info">
            <div class="name"></div>
            <div class="content"></div>
            <div class="badgelist"></div>
        </div>
        <hr>
        <canvas id="solvelog"></canvas>
        <div class="i-card-title"><p>Scoreings</p></div>
        <table class="table" id="rankings">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>题目</th>
                    <th>类型</th>
                    <th>分数</th>
                    <th>时间</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <nav id="page" style="display: none;">
            <ul class="pagination justify-content-center">
            </ul>
        </nav>
        <div class="i-card-title" style="margin-top: 40px; display: none;"><p>金币明细 <span style="font-size: 14px;color: #999;">New 10</span></p></div>
        <table class="table" id="money" style="display: none;">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>变化</th>
                    <th>总数</th>
                    <th>备注</th>
                    <th>时间</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>  
</div>
{include file="footer" /}
<script src="/public/static/js/chart.js"></script>
<script>
$(".loading").show();
$(".i-card-main").hide();
var urlArr = window.location.href.split('/');
var last = urlArr[urlArr.length - 1];
$(document).ready(function(){
    $.get('/api/v1/getHomeInfo/' + last, function (res) {
        if (res.code == 200) {
            var html = "";
            $('.name').text(res.data.username);
            $('.content').text(res.data.content);
            if (res.data.avatar) {
                $('.avatar img').attr('src', res.data.avatar);
            }
            for(var i = 0; i < res.data.count; i++){
                html += "<tr><th scope='row'>" + (i+1) + "</th><td><a href='/#solve-" + res.data.data[i].id + "' target='_blank'>" + res.data.data[i].title + "</a></td><td>" + res.data.data[i].category + "</td><td>" + res.data.data[i].score + "</td><td>" + timestampToTime(res.data.data[i].time) + "</td></tr>";
            }
            badgelist = '<span class="badge badge-light">排名：' + res.data.rank + '</span> <span class="badge badge-light">擅长：' + res.data.category + '</span> <span class="badge badge-light">总分：' + res.data.scores + '</span> <span class="badge badge-light">金币：' + res.data.money + '</span> ';
            $('.badgelist').html(badgelist);
            if (res.data.website) {
                $('.badgelist').append('<span class="badge badge-light"><a href="' + res.data.website + '" target="_blank"><i class="iconfont icon-url"></i></a></span>');
            }
            
            $("#rankings tbody").html(html);
            if (res.data.moneys) {
                var moneyHtml = "";
                for(var i = 0; i < res.data.moneys.length; i++){
                    if (res.data.moneys[i].type.indexOf('奖励') != -1) {
                        var total = '增加' + res.data.moneys[i].money + '枚'
                    } else {
                        var total = '减少' + res.data.moneys[i].money + '枚'
                    }
                    moneyHtml += "<tr><th scope='row'>" + (i+1) + "</th><td>" + total + "</td><td>" + res.data.moneys[i].last + "</td><td>" + res.data.moneys[i].type + "</td><td>" + timestampToTime(res.data.moneys[i].time) + "</td></tr>";
                }
                $("#money tbody").html(moneyHtml);
                $("#money").show();
                $(".i-card-title").eq(1).show();
            }

            var ctx = document.getElementById("solvelog");
            ctx.height = 50;
            let labels = [];
            let data = [];

            for (let i = 13; i >= 0; i--) {
                let d = new Date();
                d.setDate(d.getDate() - i);
                labels.push(d.getMonth() + 1 + "-" + d.getDate());
            }

            if (res.data.solvelog.length == 0) {
               data = [0,0,0,0,0,0,0,0,0,0,0,0,0,0]
            }else{
                for (let i = 0; i < res.data.solvelog.length; i++) {
                    for (let j = 0; j < labels.length; j++) {
                        let index = labels.indexOf(res.data.solvelog[i].time);
                        if (index != -1) {
                            data[index] = res.data.solvelog[i].score;
                        }
                        if (data[j] == undefined) {
                            data[j] = 0;
                        }
                    }
                }
            }

            setTimeout(function () {
                $(".loading").hide();
                $(".i-card-main").show();
                new Chart(ctx, {
                    type: "line",
                    data: {
                        labels: labels,
                        datasets: [{                        
                            data: data,
                            label: "分数",
                            borderColor: "#28c76f",
                            backgroundColor: "rgba(40, 199, 111, 0.3)",
                        }]
                    },
                    options: {
                        plugins: {
                            legend: {
                                display: false
                            },                            
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                getPage(res)
            }, 500);
        }else{
            layer.msg(res.msg, {icon: 2});
            $(".loading").hide();
            setTimeout(function () {
                window.location.href = '/';
            }, 1000);
        }
    })
})
</script>
 </body></html>